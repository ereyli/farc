<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>$FARC â€“ The Farcaster Token</title>

  <!-- Icons & Manifest -->
  <link rel="icon" type="image/png" href="/farc.png" />
  <link rel="manifest" href="/farcaster.json" />

  <!-- Farcaster Frame Meta -->
  <meta name="fc:frame" content="vNext" />
  <meta name="fc:frame:image" content="https://farc.vercel.app/farc.png" />
  <meta name="fc:frame:button:1" content="Launch App" />
  <meta name="fc:frame:button:1:action" content="launch_frame" />
  <meta name="fc:frame:button:1:target" content="https://farc.vercel.app" />

  <!-- Ethers.js -->
  <script src="https://cdn.jsdelivr.net/npm/ethers@5.7.2/dist/ethers.umd.min.js"></script>

  <style>
    *{margin:0;padding:0;box-sizing:border-box}
    body{font-family:-apple-system,BlinkMacSystemFont,'Segoe UI',Roboto,sans-serif;background:linear-gradient(135deg,#8B5CF6 0%,#6366F1 100%);color:#fff;min-height:100vh;padding:20px}
    .container{max-width:400px;margin:0 auto}
    .header{text-align:center;margin-bottom:30px}
    .logo{width:120px;height:120px;border-radius:20px;margin-bottom:20px}
    h1{font-size:36px;margin-bottom:10px}
    .card{background:rgba(255,255,255,.1);backdrop-filter:blur(10px);border-radius:20px;padding:20px;margin-bottom:20px;border:1px solid rgba(255,255,255,.2)}
    .button{width:100%;padding:15px;border:none;border-radius:12px;font-size:16px;font-weight:bold;cursor:pointer;transition:.3s}
    .button-primary{background:#10b981;color:#fff}
    .button-primary:hover{background:#059669}
    .button-primary:disabled{background:#6b7280;cursor:not-allowed;opacity:.7}
    .button-secondary{background:rgba(255,255,255,.2);color:#fff;margin-top:10px}
    .button-secondary:hover{background:rgba(255,255,255,.3)}
    .button-amount{padding:10px;font-size:14px;background:rgba(139,92,246,.2);border:1px solid rgba(139,92,246,.4)}
    .button-amount:hover{background:rgba(139,92,246,.3)}
    .button-amount.active{background:rgba(139,92,246,.5);border-color:#8B5CF6}
    .info-row{display:flex;justify-content:space-between;margin-bottom:10px}
    .loading{text-align:center;padding:50px}
    .hidden{display:none}
    .wallet-badge{display:inline-flex;align-items:center;gap:8px;background:rgba(139,92,246,.2);border:1px solid rgba(139,92,246,.4);padding:8px 16px;border-radius:20px;font-size:14px}
    input[type=number]{width:100%;padding:12px;margin:10px 0;border-radius:8px;border:1px solid rgba(255,255,255,.2);background:rgba(255,255,255,.1);color:#fff;font-size:16px;text-align:center}
    input[type=number]::placeholder{color:rgba(255,255,255,.6)}
    .error,.success{padding:10px;border-radius:8px;margin:10px 0;font-size:14px;text-align:center}
    .error{background:rgba(239,68,68,.2);border:1px solid rgba(239,68,68,.4)}
    .success{background:rgba(16,185,129,.2);border:1px solid rgba(16,185,129,.4)}
  </style>
</head>
<body>
  <div class="container">
    <div id="loading" class="loading"><h2>Loading $FARC...</h2></div>

    <div id="app" class="hidden">
      <div class="header">
        <img src="/farc.png" alt="FARC" class="logo" />
        <h1>$FARC</h1>
        <p id="header-text">The Official Farcaster Token</p>
        <p style="font-size:14px;opacity:.8;margin-top:5px">ðŸŸ£ Farcaster Exclusive</p>
      </div>

      <div class="card">
        <h2>ðŸ”¥ Presale LIVE</h2>
        <div class="info-row"><span>Network:</span><strong>Base (8453)</strong></div>
        <div class="info-row"><span>Price:</span><strong>0.01 ETH = 1M FARC</strong></div>
        <div class="info-row"><span>Max / wallet:</span><strong>5M FARC</strong></div>
        <div class="info-row"><span>Sold:</span><strong id="tokens-sold">0M / 1000M</strong></div>
      </div>

      <div class="card">
        <h3>Buy $FARC</h3>

        <div id="message-area"></div>

        <div style="display:grid;grid-template-columns:repeat(3,1fr);gap:10px;margin-bottom:10px">
          <button class="button button-amount" data-amt="0.001">0.001<br/><small>0.1M</small></button>
          <button class="button button-amount active" data-amt="0.01">0.01<br/><small>1M</small></button>
          <button class="button button-amount" data-amt="0.05">0.05<br/><small>5M</small></button>
        </div>

        <input id="amount-input" type="number" step="0.001" min="0.001" max="0.05" value="0.01" placeholder="Amount in ETH" />

        <div id="token-preview" style="text-align:center;margin:10px 0;padding:8px;background:rgba(16,185,129,.1);border-radius:8px">You will receive: <strong>1M FARC</strong></div>

        <div id="wallet-info" style="text-align:center;margin:10px 0;font-size:14px;opacity:.8"></div>

        <button id="action-button" class="button button-primary" disabled>Loading...</button>
        <button class="button button-secondary" onclick="window.shareToken()">Share $FARC ðŸ“¢</button>
      </div>
    </div>
  </div>

  <script>
    /* ---------- CONFIG ---------- */
    const CONTRACT_ADDRESS='0xdc73ad5d961d32703db3c61b4294ac5b584bfbdc';
    const CONTRACT_ABI=['function buyTokens() payable','function getInfo() view returns(bool,uint256,uint256,uint256)'];

    /* ---------- STATE ---------- */
    let provider,ethersProvider,signer,contract,userAddr=null;const isFrame=window!==window.parent;

    /* ---------- HELPERS ---------- */
    const $=i=>document.getElementById(i);
    const preview=()=>{const v=parseFloat($('amount-input').value)||0;$('token-preview').innerHTML=v?`You will receive: <strong>${v*100}M FARC</strong>`:'Enter amount';};
    const msg=(t,c)=>$('message-area').innerHTML=`<div class="${c}">${t}</div>`;
    const clear=()=>$('message-area').innerHTML='';
    const showApp=()=>{$('loading').classList.add('hidden');$('app').classList.remove('hidden');};

    /* ---------- INIT ---------- */
    (async()=>{
      try{
        // Environment
        if(isFrame){const {sdk}=await import('https://esm.sh/@farcaster/frame-sdk');await sdk.actions.ready({disableNativeGestures:true});window.sdk=sdk;provider=sdk.wallet?.ethProvider;}
        else{provider=window.ethereum; if(!provider) return msg('Install MetaMask','error'); ethersProvider=new ethers.providers.Web3Provider(provider);}  
        if(provider.on){provider.on('accountsChanged',a=>handleAcct(a[0]||null));provider.on('chainChanged',()=>location.reload());}
        const acc=await provider.request({method:'eth_accounts'});handleAcct(acc[0]);
        // UI bindings
        document.querySelectorAll('.button-amount').forEach(btn=>btn.onclick=()=>{document.querySelectorAll('.button-amount').forEach(b=>b.classList.remove('active'));btn.classList.add('active');$('amount-input').value=btn.dataset.amt;preview();});
        $('amount-input').addEventListener('input',preview);
        preview();
        showApp();
        loadInfo();
      }catch(e){console.error(e);msg('Init error','error');showApp();}
    })();

    /* ---------- WALLET ---------- */
    async function connect(){try{const acc=await provider.request({method:'eth_requestAccounts'});handleAcct(acc[0]);}catch(e){msg('Connect cancelled','error');}}
    function handleAcct(addr){if(!addr){userAddr=null;updateDisc();return;}userAddr=addr;if(!isFrame){ethersProvider??=new ethers.providers.Web3Provider(provider);signer=ethersProvider.getSigner();contract=new ethers.Contract(CONTRACT_ADDRESS,CONTRACT_ABI,signer);}updateConn();}

    /* ---------- UI STATES ---------- */
    function updateConn(){$('wallet-info').innerHTML=`<div class="wallet-badge"><span>ðŸŸ£</span><span>${userAddr.slice(0,6)}...${userAddr.slice(-4)}</span></div>`;$('action-button').disabled=false;$('action-button').innerText='Buy FARC ðŸš€';$('action-button').onclick=buy;}
    function updateDisc(){$('wallet-info').innerHTML='';$('action-button').disabled=false;$('action-button').innerText='Connect Wallet';$('action-button').onclick=connect;}

    /* ---------- BUY ---------- */
    async function buy(){const eth=parseFloat($('amount-input').value);if(!eth){msg('Enter amount','error');return;}try{$('action-button').disabled=true;const wei=ethers.utils.parseEther(eth.toString());if(isFrame){await provider.request({method:'eth_sendTransaction',params:[{from:userAddr,to:CONTRACT_ADDRESS,value:wei.toHexString()}]});}else{const tx=await contract.buyTokens({value:wei});await tx.wait();}msg('Success!','success');loadInfo();}catch(e){msg(e.code===4001?'Tx cancelled':'Tx failed','error');}finally{$('action-button').disabled=false;}}

    /* ---------- INFO ---------- */
    async function loadInfo(){try{let sold=0,total=1000e6;if(!isFrame&&ethersProvider){const read=new ethers.Contract(CONTRACT_ADDRESS,CONTRACT_ABI,ethersProvider);const i=await read.getInfo();sold=parseFloat(ethers.utils.formatUnits(i[1],18));total=sold+parseFloat(ethers.utils.formatUnits(i[2],18));}$('tokens-sold').innerText=`${(sold/1e6).toFixed(0)}M / ${(total/1e6).toFixed(0)}M`; }catch(e){console.log(e);}}

    /* ---------- SHARE ---------- */
    window.shareToken=()=>{const txt='ðŸš€ Check out $FARC â€“ The Farcaster Token!\n0.01 ETH = 1M FARC\nhttps://farc.vercel.app';navigator.share?navigator.share({title:'$FARC',text:txt}).catch(()=>copy(txt)):copy(txt);};
    const copy=t=>navigator.clipboard.writeText(t).then(()=>msg('Copied','success')).catch(()=>msg('Copy failed','error'));
  </script>
</body>
</html>
