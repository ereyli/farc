<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>$FARC - The Farcaster Token</title>
  <link rel="icon" type="image/png" href="/farc.png" />
  <link rel="manifest" href="/farcaster.json" />

  <!-- Farcaster Mini App Meta -->
  <meta name="fc:frame" content="vNext" />
  <meta name="fc:frame:image" content="https://farc.vercel.app/farc.png" />
  <meta name="fc:frame:button:1" content="Launch App" />
  <meta name="fc:frame:button:1:action" content="launch_frame" />
  <meta name="fc:frame:button:1:target" content="https://farc.vercel.app" />

  <style>
    body {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
      background: linear-gradient(135deg, #8B5CF6 0%, #6366F1 100%);
      color: white;
      margin: 0;
      padding: 20px;
      min-height: 100vh;
    }

    .container {
      max-width: 400px;
      margin: 0 auto;
      text-align: center;
    }

    .logo {
      width: 120px;
      height: 120px;
      border-radius: 20px;
      margin-bottom: 20px;
    }

    .card {
      background: rgba(255, 255, 255, 0.1);
      backdrop-filter: blur(10px);
      border-radius: 20px;
      padding: 20px;
      margin-top: 20px;
      border: 1px solid rgba(255, 255, 255, 0.2);
    }

    .button {
      width: 100%;
      padding: 15px;
      border: none;
      border-radius: 12px;
      font-size: 16px;
      font-weight: bold;
      cursor: pointer;
      margin-top: 10px;
    }

    .primary {
      background: #10b981;
      color: white;
    }

    .secondary {
      background: rgba(255, 255, 255, 0.2);
      color: white;
    }

    input[type="number"] {
      width: 100%;
      padding: 10px;
      margin: 10px 0;
      border-radius: 8px;
      border: none;
      font-size: 16px;
    }

    .hidden {
      display: none;
    }

    .error {
      margin-top: 40px;
      color: #fecaca;
      font-size: 18px;
    }
  </style>
</head>
<body>
  <div class="container">
    <div id="loading">
      <h2>Loading $FARC...</h2>
    </div>

    <div id="app" class="hidden">
      <img src="/farc.png" alt="FARC Logo" class="logo" />
      <h1>$FARC</h1>
      <p>The Official Farcaster Token</p>
      <p style="font-size: 14px; opacity: 0.8;">üü£ Farcaster Exclusive</p>

      <div class="card">
        <h2>üî• Presale LIVE</h2>
        <p><strong>0.01 ETH = 1M FARC</strong></p>
        <p><strong>Max per wallet: 5M FARC</strong></p>
        <p><strong>Sold: 125M / 500M</strong></p>
      </div>

      <div class="card">
        <h3>Buy $FARC</h3>
        <input
          type="number"
          id="amount-input"
          placeholder="Amount in ETH (e.g. 0.01)"
          step="0.001"
          min="0.001"
        />
        <div id="wallet-info" style="margin: 10px 0; font-size: 14px; opacity: 0.8;"></div>
        <button id="buy-button" class="button primary">Connect Farcaster Wallet</button>
        <button onclick="share()" class="button secondary">Share $FARC üì¢</button>
      </div>
    </div>

    <div id="error" class="error hidden">
      ‚ö†Ô∏è Please open this app inside <strong>Farcaster</strong> (Warpcast).
    </div>
  </div>

  <script type="module">
    import { sdk } from 'https://esm.sh/@farcaster/frame-sdk';

    window.ethereum = null; // Disable MetaMask completely

    const loading = document.getElementById('loading');
    const app = document.getElementById('app');
    const errorBox = document.getElementById('error');
    const buyButton = document.getElementById('buy-button');
    const walletInfo = document.getElementById('wallet-info');
    let userAddress = null;

    function showApp() {
      loading.classList.add('hidden');
      errorBox.classList.add('hidden');
      app.classList.remove('hidden');
    }

    function showError() {
      loading.classList.add('hidden');
      app.classList.add('hidden');
      errorBox.classList.remove('hidden');
    }

    function handleConnection(address) {
      userAddress = address;
      walletInfo.innerHTML = `üü£ ${address.slice(0, 6)}...${address.slice(-4)}`;
      buyButton.textContent = 'Buy FARC üöÄ';
      buyButton.onclick = buyTokens;
    }

    function buyTokens() {
      const amount = parseFloat(document.getElementById('amount-input').value);
      if (!amount || amount <= 0) {
        alert('Enter a valid amount');
        return;
      }
      const tokens = amount * 100;
      alert(`‚úÖ You will receive ${tokens}M FARC.\n\nSmart contract coming soon.`);
    }

    window.share = function () {
      const text = 'Check out $FARC - The Official Farcaster Token! üöÄ\n\nPresale: 0.01 ETH = 1M FARC\nMax 5M per wallet\n\nhttps://farc.vercel.app';
      if (navigator.share) {
        navigator.share({ title: '$FARC Token', text });
      } else {
        navigator.clipboard.writeText(text);
        alert('Share text copied to clipboard!');
      }
    };

    window.addEventListener('DOMContentLoaded', async () => {
      try {
        await sdk.actions.ready();
        const context = await sdk.context;

        if (!context?.user) {
          showError();
          return;
        }

        window.farcasterUser = context.user;

        const header = document.querySelector('.header p');
        if (header && context.user.username) {
          header.innerHTML = `The Official Farcaster Token<br><small>üë§ @${context.user.username}</small>`;
        }

        const address = context.user.verifiedAddresses?.ethAddresses?.[0];
        if (!address) {
          walletInfo.innerHTML = '‚ö†Ô∏è No verified wallet. Add one in Warpcast settings.';
          buyButton.disabled = true;
          buyButton.textContent = 'No Verified Address';
        } else {
          handleConnection(address);
        }

        showApp();
      } catch (err) {
        console.error('Farcaster SDK error:', err);
        showError();
      }
    });
  </script>
</body>
</html>
